# 简介

重入攻击是指利用合约漏洞（如fallback函数）循环调用合约的攻击方法。

# 原理

重入攻击的本质是合约内部调用的函数未能恰当地处理合约状态的更改。攻击者利用这个漏洞，将攻击代码插入到合约执行流程中，使得攻击者可以在合约还未完成之前再次调用某个函数(如: fallback, receive)，从而让攻击者在合约中获得额外的资产或信息。

# 案例

- 2016年，The DAO合约被重入攻击，被盗取3,600,000枚ETH。从而导致了以太坊进行硬分叉，分叉成以太坊和以太坊经典
- 2019年，合成资产平台 Synthetix 遭受重入攻击，被盗 3,700,000 枚 sETH。
- 2020年，借贷平台 http://Lendf.me 遭受重入攻击，被盗 $25,000,000。
- 2021年，借贷平台 CREAM FINANCE 遭受重入攻击，被盗 $18,800,000。
- 2022年，算法稳定币项目 Fei 遭受重入攻击，被盗 $80,000,000。

# 如何避免

1. 检查-生效-交互（checks-effect-interaction）

检查-生效-交互模式是指，编写合约函数时：

1. 先检查状态是否满足条件。
2. 再更新状态。
3. 最后再和其它合约进行交互。

通过这种方式，可将状态更新置于合约交互之前，使重入无效。

4. 重入锁

重入锁是一种防止重入函数的修饰器（modifier）。它通过一个默认为0 的状态变量_status 来控制被修饰函数是否应该被顺利执行。被重入锁修饰的函数，在第一次调用时会检查_status是否为0，紧接着将_status的值设置为1，调用结束后再将_status改为0。这样，当攻击合约在调用结束前第二次的调用就会报错，重入攻击就失败了。